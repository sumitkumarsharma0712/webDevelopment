<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Car Racing Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #111;
      font-family: Arial, sans-serif;
    }

    /* Dashboard */
    .dashboard {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 20px;
      background: rgba(0,0,0,0.6);
      padding: 10px 30px;
      border-radius: 10px;
      z-index: 2;
    }

    /* Road Area */
    .road {
      position: relative;
      width: 400px;
      height: 100vh;
      margin: auto;
      border-left: 10px solid white;
      border-right: 10px solid white;
      perspective: 800px;
      overflow: hidden;
    }

    /* Lane Lines */
    .line {
      position: absolute;
      width: 10px;
      height: 100px;
      background: white;
      left: 50%;
      top: -100px;
      transform: translateX(-50%);
      animation: moveLines 1s linear infinite;
    }
    @keyframes moveLines {
      0% { top: -100px; }
      100% { top: 100vh; }
    }

    /* Player Car */
    .car {
      position: absolute;
      width: 60px;
      height: 120px;
      bottom: 20px;
      left: 170px;
      border-radius: 10px;
      box-shadow: 0 0 25px rgba(255,255,255,0.7);
      transition: left 0.2s;
    }

    /* Opponent */
    .opponent {
      position: absolute;
      width: 60px;
      height: 120px;
      top: -150px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }

    /* Scenery */
    .tree, .building {
      position: absolute;
      bottom: 0;
      background: green;
      width: 50px;
      height: 100px;
      animation: moveScenery 3s linear infinite;
    }
    .building {
      background: gray;
      width: 70px;
      height: 200px;
    }
    @keyframes moveScenery {
      0% { bottom: -200px; }
      100% { bottom: 100vh; }
    }

    /* Car Selection Menu */
    .menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 3;
    }
    .menu h1 {
      font-size: 36px;
      margin-bottom: 20px;
    }
    .car-options {
      display: flex;
      gap: 20px;
      margin: 20px 0;
    }
    .car-choice {
      width: 60px;
      height: 120px;
      border-radius: 10px;
      cursor: pointer;
      border: 3px solid white;
      transition: transform 5s;
    }
    .car-choice:hover {
      transform: scale(1.2);
    }

    /* Road Style Switcher */
    .road.grass { background: linear-gradient(#1a472a, #3e8e41); }
    .road.desert { background: linear-gradient(#c2b280, #e0c97f); }
    .road.snow { background: linear-gradient(#e0e0e0, #ffffff); }
    .road.city { background: linear-gradient(#222, #444); }
  </style>
</head>
<body>
  <!-- Dashboard -->
  <div class="dashboard">
    üèé Score: <span id="score">0</span> | ‚ö° Level: <span id="level">1</span> | üèÜ High Score: <span id="highScore">0</span>
  </div>

  <!-- Menu -->
  <div class="menu" id="menu">
    <h1>üèÅ Select Your Car</h1>
    <div class="car-options">
      <div class="car-choice" style="background:red" data-color="red"></div>
      <div class="car-choice" style="background:blue" data-color="blue"></div>
      <div class="car-choice" style="background:yellow" data-color="yellow"></div>
      <div class="car-choice" style="background:purple" data-color="purple"></div>
    </div>
    <h2>üåç Choose Road</h2>
    <button onclick="startGame('grass')">üåø Grass</button>
    <button onclick="startGame('desert')">üèú Desert</button>
    <button onclick="startGame('snow')">‚ùÑ Snow</button>
    <button onclick="startGame('city')">üèô City</button>
  </div>

  <!-- Road -->
  <div class="road" id="road">
    <div class="line"></div>
    <div class="line" style="animation-delay:0.5s;"></div>
    <div class="car" id="player"></div>
  </div>

  <!-- Sound -->
  <audio id="raceSound" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_41d82bb17a.mp3?filename=racing-car-6952.mp3" type="audio/mp3">
  </audio>

  <script>
    const menu = document.getElementById("menu");
    const player = document.getElementById("player");
    const road = document.getElementById("road");
    const scoreDisplay = document.getElementById("score");
    const levelDisplay = document.getElementById("level");
    const highScoreDisplay = document.getElementById("highScore");
    const raceSound = document.getElementById("raceSound");

    let score = 0, level = 1, speed = 2, playerX = 170;
    let gameOver = false, nitro = false, playerColor = "red";

    // Load high score
    let highScore = localStorage.getItem("highScore") || 0;
    highScoreDisplay.innerText = highScore;

    // Car selection
    document.querySelectorAll(".car-choice").forEach(car => {
      car.addEventListener("click", () => {
        playerColor = car.dataset.color;
        player.style.background = playerColor;
      });
    });

    // Start game
    function startGame(roadType) {
      menu.style.display = "none";
      road.classList.add(roadType);
      raceSound.play();
      spawnOpponent();
      spawnScenery();
    }

    // Controls
    document.addEventListener("keydown", e => {
      if(gameOver) return;
      if(e.key === "ArrowLeft" && playerX > 40) { playerX -= 70; }
      if(e.key === "ArrowRight" && playerX < 300) { playerX += 70; }
      if(e.key === " ") { nitro = true; speed += 2; }
      player.style.left = playerX + "px";
    });
    document.addEventListener("keyup", e => { if(e.key === " ") { nitro = false; speed -= 2; } });

    // Opponents
    function spawnOpponent() {
      if(gameOver) return;
      const opp = document.createElement("div");
      opp.classList.add("opponent");
      opp.style.left = (Math.floor(Math.random() * 5) * 70 + 40) + "px";
      opp.style.top = "-150px";
      opp.style.background = ["blue","green","orange","pink"][Math.floor(Math.random()*4)];
      road.appendChild(opp);

      let moveInterval = setInterval(() => {
        if(gameOver) { clearInterval(moveInterval); opp.remove(); return; }
        let top = parseInt(opp.style.top);
        opp.style.top = top + speed + "px";

        // Collision
        const playerRect = player.getBoundingClientRect();
        const oppRect = opp.getBoundingClientRect();
        if (playerRect.x < oppRect.x + oppRect.width &&
            playerRect.x + playerRect.width > oppRect.x &&
            playerRect.y < oppRect.y + oppRect.height &&
            playerRect.height + playerRect.y > oppRect.y) {
          gameOver = true;
          raceSound.pause();
          if(score > highScore) {
            localStorage.setItem("highScore", score);
          }
          document.querySelector(".dashboard").innerHTML = "üíÄ Game Over! Final Score: "+score+" | Refresh to Play Again";
          clearInterval(moveInterval);
        }

        // Passed safely
        if(top > window.innerHeight) {
          opp.remove();
          score++; scoreDisplay.innerText = score;
          if(score % 10 === 0) { level++; levelDisplay.innerText = level; speed++; }
        }
      }, 30);

      setTimeout(spawnOpponent, Math.random() * 2000 + 1000);
    }

    // Scenery
    function spawnScenery() {
      if(gameOver) return;
      const item = document.createElement("div");
      item.classList.add(Math.random() > 0.5 ? "tree" : "building");
      item.style.left = (Math.random() > 0.5 ? "-80px" : "420px");
      road.appendChild(item);
      setTimeout(() => item.remove(), 4000);
      setTimeout(spawnScenery, Math.random() * 3000 + 2000);
    }
  </script>
</body>
</html>
